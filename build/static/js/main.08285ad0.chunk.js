(this["webpackJsonpreact-app"]=this["webpackJsonpreact-app"]||[]).push([[0],{19:function(e,t,n){e.exports=n(39)},24:function(e,t,n){},32:function(e,t){},33:function(e,t){},34:function(e,t){},35:function(e,t){},36:function(e,t){},37:function(e,t){},38:function(e,t,n){},39:function(e,t,n){"use strict";n.r(t);var a=n(1),i=n.n(a),r=n(16),o=n.n(r),s=n(2),l=n(3),c=n(6),u=n(5),d=n(4),h=n(7);n(24);function v(e){for(var t=[],n=0;n<e[0];n++)t[n]=new Float32Array(e[1]);return t}function g(e,t,n,a,i){var r=(t=[t[0]+a[0],t[1]+a[1]])[0],o=t[1],s=e.length,l=e[0].length,c=s-2*a[0],u=l-2*a[1];if(i.length!==c||i[0].length!==u)throw new Error("Output matrix has the wrong dimensions. Expected:"+c+"x"+u+" ,Actual:"+i.length+"x"+i[0].length);for(var d=0;d<c;d++)for(var h=d+r,v=e[h],g=i[d],m=0;m<u;m++){var b=m+o;g[m]=h>=0&&h<s&&b>=0&&b<l?v[m+o]:n}}function m(e){for(var t=e.length,n=e[0].length,a=0,i=new Float32Array(t*n),r=0;r<t;r++)for(var o=0;o<n;o++)i[a]=e[r][o],a++;return i}var b=function e(t,n){Object(s.a)(this,e),this.tileTypes=t,this.score=n},p=function e(t,n,a,i){Object(s.a)(this,e),this.tileTypes=t,this.position=n,this.score=a,this.isComplete=i},f=function(){return new p(function(e){for(var t=[],n=e[0],a=e[1],i=0;i<n;i++){t[i]=new Array(a);for(var r=0;r<e[1];r++)t[i][r]=Math.random()<.2?1:0}return t}(y.size),[Math.floor(y.size[0]/2),0],0,!1)};var y={size:[31,31],viewPortSize:[9,9],viewPortOffset:[0,2],viewPortPosition:[4,2],verticalDeltaScore:.01,deltaScorePerAction:-.01,tileTypeToDeltaScore:[0,-.2],getToBottomDeltaScore:1},S=["w","a","s","d"],O=function(){function e(){Object(s.a)(this,e),this._state=f(),this.applyAction=this.applyAction.bind(this),this.getAgentObservation=this.getAgentObservation.bind(this),this.getGodObservation=this.getGodObservation.bind(this),this.viewportOutputMatrix=v(y.viewPortSize)}return Object(l.a)(e,[{key:"applyAction",value:function(e){var t=0;switch(e){case"w":this._state.position[1]>0?(this._state.position[1]--,this._state.score-=y.verticalDeltaScore):t=y.tileTypeToDeltaScore[1];break;case"a":this._state.position[0]>0?this._state.position[0]--:t=y.tileTypeToDeltaScore[1];break;case"s":this._state.position[1]++,this._state.score=this._state.score+y.verticalDeltaScore;break;case"d":this._state.position[0]<y.size[0]-1?this._state.position[0]++:t=y.tileTypeToDeltaScore[1];break;default:throw new Error("Unknown action: "+e)}var n=this._state.tileTypes[this._state.position[0]][this._state.position[1]];this._state.score+=y.tileTypeToDeltaScore[n]+y.deltaScorePerAction+t,this._state.isComplete=this._state.position[1]===y.size[1]-1,this._state.isComplete&&(this._state.score+=y.getToBottomDeltaScore)}},{key:"getAgentObservation",value:function(){var e=[Math.ceil(this._state.position[0]-y.size[0]/2),Math.ceil(this._state.position[1]-y.size[0]/2)+y.viewPortOffset[1]],t=[Math.floor((y.size[0]-y.viewPortSize[0])/2),Math.floor((y.size[1]-y.viewPortSize[1])/2)];g(this._state.tileTypes,e,1,t,this.viewportOutputMatrix);var n=y.size[1]-t[1]-e[1];if(n<y.viewPortSize[1])for(var a=0;a<y.viewPortSize[0];a++)for(var i=n;i<y.viewPortSize[1];i++)this.viewportOutputMatrix[a][i]=0;return new b(this.viewportOutputMatrix,this._state.score)}},{key:"getGodObservation",value:function(){return this._state}}]),e}(),_=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).state={gameNumber:0,previousPositions:[]},e}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){if(e.gameNumber!==this.state.gameNumber)this.setState({gameNumber:e.gameNumber,previousPositions:[]});else{var t=this.state.previousPositions.slice();t[e.godObservation.position[0]*e.godObservation.tileTypes.length+e.godObservation.position[1]]=!0,this.setState({previousPositions:t})}}},{key:"render",value:function(){var e=function(e,t){for(var n=[],a=e.length,i=e[0].length,r=0;r<a;r++)for(var o=0;o<i;o++){var s={r:50,g:50,b:50};r===t[0]&&o===t[1]&&0!==e[r][o]?s={r:255,g:255,b:0}:r===t[0]&&o===t[1]?s={r:0,g:255,b:0}:0!==e[r][o]&&(s={r:230,g:0,b:0}),n[o]||(n[o]=[]),n[o][r]="rgb("+s.r+","+s.g+","+s.b+")"}return n}(this.props.agentObservation.tileTypes,y.viewPortPosition),t=function(e,t,n){for(var a=[],i=e.length,r=e[0].length,o=0;o<i;o++)for(var s=0;s<r;s++){var l=n[o*i+s],c={r:50,g:50,b:50};o===t[0]&&s===t[1]&&0!==e[o][s]?c={r:255,g:255,b:0}:o===t[0]&&s===t[1]?c={r:0,g:255,b:0}:l&&0!==e[o][s]?c={r:255,g:255,b:128}:l?c={r:0,g:128,b:0}:0!==e[o][s]&&(c={r:230,g:0,b:0}),a[s]||(a[s]=[]),a[s][o]="rgb("+c.r+","+c.g+","+c.b+")"}return a}(this.props.godObservation.tileTypes,this.props.godObservation.position,this.state.previousPositions);return i.a.createElement("div",{className:"InfectionGameHtmlTableRender"},i.a.createElement("div",null,i.a.createElement("span",null,"Agent View"),i.a.createElement("table",{className:"renderer-table-canvas-agent"},i.a.createElement("tbody",null,e.map((function(e,t){return i.a.createElement("tr",{key:t},e.map((function(e,t){return i.a.createElement("td",{key:t,style:{backgroundColor:e}})})))}))))),i.a.createElement("div",null,i.a.createElement("span",null,"Environment View"),i.a.createElement("table",{className:"renderer-table-canvas-god"},i.a.createElement("tbody",null,t.map((function(e,t){return i.a.createElement("tr",{key:t},e.map((function(e,t){return i.a.createElement("td",{key:t,style:{backgroundColor:e}})})))}))))))}}]),t}(a.Component);var w=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).onExportButtonClick=e.onExportButtonClick.bind(Object(d.a)(e)),e.state={exportData:null},e}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onExportButtonClick",value:function(){var e=this.props.gameRunner;e.getCurrentAgentInstance().exportBrain?this.setState({exportData:"export const data = JSON.parse('"+JSON.stringify(e.getCurrentAgentInstance().exportBrain())+"');"}):alert("Current agent has no exportBrain() function.")}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("button",{onClick:this.onExportButtonClick},"Export Agent Brain"),this.state.exportData&&i.a.createElement("div",null,i.a.createElement("br",null),i.a.createElement("div",null,"Exported Agent Brain Data:"),i.a.createElement("textarea",{autoFocus:!0,readOnly:!0,style:{width:"100%",height:"10em"},value:this.state.exportData})))}}]),t}(a.Component),k=n(17),A=n.n(k),C=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this.refs.chart,t=new A.a(e,{type:"line",data:{labels:[],datasets:[{label:"Average Final Score",data:[],backgroundColor:"transparent",borderColor:"blue",borderWidth:1,lineTension:0},{label:"Final Score",data:[],backgroundColor:"transparent",borderColor:"lightgrey",borderWidth:1,lineTension:0}]},options:{animation:{duration:0},elements:{point:{radius:0}},scales:{yAxes:[{ticks:{min:-1,max:1}}],xAxes:[{display:!1}]}}});this.setState({chart:t})}},{key:"mapStatsToChartData",value:function(e){return{datasets:[{data:e.gameCountToAverageScore.slice(-200)},{data:e.gameCountToScore.slice(-200)}],labels:Object.keys(e.gameCountToScore).slice(-200)}}},{key:"componentDidUpdate",value:function(){var e=this.state.chart,t=this.mapStatsToChartData(this.props.stats);t.datasets.forEach((function(t,n){return e.data.datasets[n].data=t.data})),e.data.labels=t.labels,e.update()}},{key:"render",value:function(){return i.a.createElement("canvas",{ref:"chart",height:"300",width:"700"})}}]),t}(a.Component),E=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.environmentConfig;return i.a.createElement("div",null,"Game Rules:",i.a.createElement("ul",null,i.a.createElement("li",null,"Get to the bottom row to finish the game"),i.a.createElement("li",null,"Gain ",e.getToBottomDeltaScore.toFixed(3)," reward for getting to the bottom"),i.a.createElement("li",null,"Lose ",(-e.tileTypeToDeltaScore[1]).toFixed(3)," reward when moving into a red square"),0!==e.deltaScorePerAction&&i.a.createElement("li",null,"Lose ",(-e.deltaScorePerAction).toFixed(3)," reward for every move"),0!==e.verticalDeltaScore&&i.a.createElement("li",null,"Gain ",e.verticalDeltaScore.toFixed(3)," reward for every row lower you go"),0!==e.verticalDeltaScore&&i.a.createElement("li",null,"Lose ",e.verticalDeltaScore.toFixed(3)," reward for every row higher you go")))}}]),t}(a.Component),x={w:"s",a:"d",s:"w",d:"a"},R={w:[0,-1,y.deltaScorePerAction-y.verticalDeltaScore],a:[-1,0,y.deltaScorePerAction],s:[0,1,y.deltaScorePerAction+y.verticalDeltaScore],d:[1,0,y.deltaScorePerAction]};function T(e,t){var n=y.viewPortPosition,a=0;return t.forEach((function(t){var i,r=R[t];n=[n[0]+r[0],n[1]+r[1]],i="undefined"===typeof e[n[0]]||"undefined"===typeof e[n[0]][n[1]]?y.tileTypeToDeltaScore[1]:y.tileTypeToDeltaScore[e[n[0]][n[1]]],a=a+r[2]+i})),a}function j(e,t,n){var a,i,r=function(e){return e.reduce((function(e,t){return null===e||t.value>e.value?t:e}),null)}(function(e,t){return t.map((function(t){return{path:t,value:T(e,t)}}))}(e,(a=t,i=x[n],a.filter((function(e){return e[0]!==i})))));return S.indexOf(r.path[0])}var P=n(18);var D=function(){function e(){Object(s.a)(this,e),this._state={lastAction:null},this.feelerPaths=function(e){for(var t=function(e){var t=[];return function e(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0===n.length)t.push(a);else for(var i=0;i<n.length;i++){var r=n.slice(),o=r.splice(i,1);e(r.slice(),a.concat(o))}}(e),t},n=[["s","s"]],a=["s","s"],i=["s","s"],r=0;r<e;r++)a.push("a"),i.push("d"),n=n.concat(t(a),t(i));return n=(n=(n=Object(P.a)(new Set(n.map((function(e){return e.join(",")})))).map((function(e){return e.split(",")}))).filter((function(e){return"s"===e[e.length-1]}))).sort((function(e,t){var n=e.join(),a=t.join();return n<a?-1:n>a?1:0}))}(4)}return Object(l.a)(e,[{key:"getAction",value:function(e,t,n){var a=j(n,this.feelerPaths,this._state.lastAction);return this._state.lastAction=a,a}},{key:"newGame",value:function(){}}],[{key:"getName",value:function(){return"HandProgrammed - LookAhead - 9x3 - ranked 0.956"}}]),e}();v([7,5]);v([5,5]);var I=v([5,3]);var G,F=n(13),B=null,N=null,M=null;function z(){document.getElementById("DQNRender")&&null!==B||(document.getElementById("agentRendererContainer").innerHTML='<div id="DQNRender">\nPredicted expected reward from each action:\n    <div style="overflow: auto"><div style="float: left">w:&nbsp;</div> <div id="action0" style="background-color: lightgoldenrodyellow"></div></div>\n    <div style="overflow: auto"><div style="float: left">a:&nbsp;</div> <div id="action1" style="background-color: lightsalmon"></div></div>\n    <div style="overflow: auto"><div style="float: left">s:&nbsp;</div> <div id="action2" style="background-color: lightskyblue"></div></div>\n    <div style="overflow: auto"><div style="float: left">d:&nbsp;</div> <div id="action3" style="background-color: lightseagreen"></div></div>\n        <div style="overflow: auto"><div style="float: left">random action:&nbsp;<span id="actionRandomValue"></span></div><div id="actionRandom" style="background-color: lightcoral;height: 1em"></div></div>\n        <br>\n        Reward from last action:\n        <div style="overflow: auto"><div style="float: left">good&nbsp;</div> <div id="good" style="background-color: greenyellow"></div></div>\n    <div style="overflow: auto"><div style="float: left">bad&nbsp;</div> <div id="bad" style="background-color: orangered"></div></div>\n<br />\n</div>',B=[document.getElementById("action0"),document.getElementById("action1"),document.getElementById("action2"),document.getElementById("action3")],N=document.getElementById("actionRandom"),G=document.getElementById("actionRandomValue"),M=[document.getElementById("good"),document.getElementById("bad")])}function L(e){z();for(var t=0,n=e.weights.length;t<n;t++){var a=e.weights[t]- -1;a<-1?a=0:a>2&&(a=2),a+=1,B[t].style.width=150*a+100+"px",B[t].innerHTML=e.weights[t].toFixed(3)}e.wasRandom?(G.innerHTML="Infinity",N.style.width="550px"):(G.innerHTML="0",N.style.width="10px")}function H(e){z();var t=0,n=0;e<0?n=-e:t=e,M[0].style.width=200*(t+1)+100+"px",M[0].innerHTML=t.toFixed(3),M[1].style.width=200*(n+1)+100+"px",M[1].innerHTML=n.toFixed(3)}var W=!0,J=Math.pow(2,15)*(W?S.length:1),K=new F.Agent(J,S.length);function V(e,t){var n=function(e){for(var t=0,n=0,a=e.length;n<a;n++)t+=e[n]*Math.pow(2,n);return t}(m((g(e,[0,-1],1,[2,3],I),I)));return W?n*(t+1):n}var Q=function(){function e(){Object(s.a)(this,e),this._lastAction=0}return Object(l.a)(e,[{key:"getAction",value:function(e,t,n){var a=V(n,this._lastAction),i=K.decide(t,a),r=K.getLastActionStats();return re.renderingEnabled&&(L({weights:r.weights,wasRandom:r.wasRandomlyChosen}),H(t)),this._lastAction=i,i}},{key:"newGame",value:function(){}},{key:"clearBrain",value:function(){K=new F.Agent(J,S.length)}},{key:"exportBrain",value:function(){return K.saveToJson()}}],[{key:"getName",value:function(){return"ReinforcementLearning - TabularSARSA - 5x3 - ranked 224"}},{key:"getDescription",value:function(){return"This agent uses the Expected-SARSA algorithm with a table-based Q function. The table stores the expected reward for "+J+" possible states. This agent views a 5x3 section of the viewport. "+(W?" It also remembers the last action it took to help avoid loops.":"")}}]),e}();function U(e){for(var t=e[0],n=0,a=1,i=e.length;a<i;a++){var r=e[a];r>t&&(n=a,t=r)}return n}var q=n(8),X=y.viewPortSize[0]*y.viewPortSize[1],Y=S.length,Z={},$=[1,81];var ee=function(){function e(){Object(s.a)(this,e),this.learnFromOARO=this.learnFromOARO.bind(this);this.options=Object.assign({discountFactor:.9,explorationProbability:.05},Z),this.model=function(){var e=q.b();return e.add(q.a.dense({inputShape:[81],units:64,activation:"relu"})),e.add(q.a.dense({units:4,activation:"linear"})),e.compile({optimizer:"adam",loss:"meanSquaredError"}),e}(),this.numberOfInputs=X,this.numberOfActions=Y,this.learnAndActCallCount=0,this.connectingObservation=null,this.lastOAR={observation:null,action:null,reward:null}}return Object(l.a)(e,[{key:"getAction",value:function(e,t,n){var a=m(n);this.lastOAR={observation:this.connectingObservation,action:e,reward:t},this.connectingObservation=a,null!==this.lastOAR.observation&&this.learnFromOARO(this.lastOAR.observation,this.lastOAR.action,this.lastOAR.reward,a);var i,r,o=!1,s=null;if(Math.random()<this.options.explorationProbability)r=this.numberOfActions,i=Math.floor(Math.random()*r),o=!0,s=[0,0,0,0];else{var l=this.modelPredict(a);s=l,i=U(l)}return re.renderingEnabled&&(L({action:i,wasRandom:o,weights:s}),null!==t&&H(t)),i}},{key:"newGame",value:function(){this.connectingObservation=null,this.lastOAR={observation:null,action:null,reward:null}}},{key:"modelPredict",value:function(e){var t=this;return q.d((function(){var n=q.c(e,$);return t.model.predictOnBatch(n).dataSync()}))}},{key:"modelTrain",value:function(e,t){var n=q.c(e,$),a=q.c(t,[1,this.numberOfActions]);this.model.trainOnBatch(n,a).then((function(e){n.dispose(),a.dispose()}))}},{key:"learnFromOARO",value:function(e,t,n,a){var i=this.estimateNextActionReward(a),r=this.modelPredict(e),o=n+i*this.options.discountFactor;r[t]=o,this.modelTrain(e,r)}},{key:"estimateNextActionReward",value:function(e){var t=this,n=this.modelPredict(e),a=n[U(n)],i=n.reduce((function(e,n){return e+n/t.numberOfActions}));return a*(1-this.options.explorationProbability)+i*this.options.explorationProbability}},{key:"clearBrain",value:function(){alert("not implemented")}},{key:"exportBrain",value:function(){alert("not implemented")}}],[{key:"getName",value:function(){return"ReinforcementLearning - DeepQNetworkTensorFlow - 9x9 - untrained"}}]),e}(),te=[{name:ee.getName(),class:ee},{class:Q,name:Q.getName(),description:Q.getDescription(),ticksPerInterval:2e4},{name:D.getName(),class:D}],ne={currentScore:0,lastGameScore:0,scoreSum:0,gameCount:0,actionCount:0,actionsPerSecond:0,lastSecondsActionCount:0,lastFinalScores:[],gameCountToScore:[],gameCountToAverageScore:[],averageFinalScore:0,lastActionScore:0,totalReward:0},ae=function(){function e(t,n){var a=this;Object(s.a)(this,e),this._universalGameNumber=0,this._renderingEnabled=!1,this._onRender=t,this._stats=Object.assign({},ne),this._onStatusChange=n,this._agentObservation=null,this._godObservation=null,this._nextAction=0,this.newGame=this.newGame.bind(this),this.takeAction=this.takeAction.bind(this),this.tick=this.tick.bind(this),this.clearStats=this.clearStats.bind(this),this.setRenderingEnabled=this.setRenderingEnabled.bind(this),this.last={action:null,reward:null},setInterval((function(){a._stats.actionsPerSecond=a._stats.actionCount-a._stats.lastSecondsActionCount,a._stats.lastSecondsActionCount=a._stats.actionCount}),1e3)}return Object(l.a)(e,[{key:"newGame",value:function(e){this._universalGameNumber++,this._agent=e,this._environment=new O,this._stats.currentScore=0,this._renderingEnabled?this._onRender(this._environment.getAgentObservation(),this._environment.getGodObservation(),this._universalGameNumber):this._onStatusChange(this._stats),this._updateObservations()}},{key:"clearCurrentAgentBrain",value:function(){this._agent.clearBrain&&this._agent.clearBrain()}},{key:"takeAction",value:function(e){var t=this._stats,n=S[e];if(null!==n&&this._environment.applyAction(n),this._updateObservations(),this._godObservation.isComplete){this._agent.getAction(this.last.action,this.last.reward,this._agentObservation.tileTypes),this._agent.newGame(),t.lastGameScore=this._agentObservation.score,t.lastFinalScores.push(this._agentObservation.score),t.lastFinalScores.length>100&&t.lastFinalScores.shift();var a=t.lastFinalScores.reduce((function(e,t){return e+t}),0);t.averageFinalScore=a/t.lastFinalScores.length||0,t.scoreSum+=this._agentObservation.score,t.gameCountToScore.push(t.lastGameScore),t.gameCountToAverageScore.push(t.averageFinalScore),t.gameCount+=1,t.gameCountToScore.length>2e3&&(t.gameCountToScore=t.gameCountToScore.slice(-1e3),t.gameCountToAverageScore=t.gameCountToAverageScore.slice(-1e3)),this.newGame(this._agent,this._renderingEnabled)}this._renderingEnabled&&(this._onRender(this._agentObservation,this._godObservation,this._universalGameNumber),t.currentScore=this._agentObservation.score,this._onStatusChange(t)),t.actionCount++;var i=this._agentObservation.score-t.lastActionScore;t.lastActionScore=this._agentObservation.score,t.totalReward+=i,this.last.reward=i,this.last.action=e,this._nextAction=this._agent.getAction(this.last.action,this.last.reward,this._agentObservation.tileTypes)}},{key:"setRenderingEnabled",value:function(e){this._renderingEnabled=e}},{key:"getCurrentAgentInstance",value:function(){return this._agent}},{key:"tick",value:function(){this.takeAction(this._nextAction)}},{key:"clearStats",value:function(){this._stats=Object.assign({},ne),this._stats.lastFinalScores=[],this._stats.gameCountToScore=[],this._stats.gameCountToAverageScore=[]}},{key:"_updateObservations",value:function(){this._agentObservation=this._environment.getAgentObservation(),this._godObservation=this._environment.getGodObservation()}}]),e}(),ie=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.stats;return i.a.createElement("table",null,i.a.createElement("tbody",null,Object.keys(e).map((function(t){return i.a.createElement("tr",{key:t},i.a.createElement("td",null,t,": ",e[t]))}))))}}]),t}(a.Component),re={renderingEnabled:!0,speed:250,ticksPerIntervalWhenNotRendering:100,autoPlay:!0},oe=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).call(this))).setupInterval=e.setupInterval.bind(Object(d.a)(e)),e.handleGameRunnerStatusChange=e.handleGameRunnerStatusChange.bind(Object(d.a)(e)),e.handleSpeedSelectorChange=e.handleSpeedSelectorChange.bind(Object(d.a)(e)),e.handleGameRendererRender=e.handleGameRendererRender.bind(Object(d.a)(e)),e.handleAgentSelectorChange=e.handleAgentSelectorChange.bind(Object(d.a)(e)),e.handleClearBrainClick=e.handleClearBrainClick.bind(Object(d.a)(e)),e.handleManualControlKeyDown=e.handleManualControlKeyDown.bind(Object(d.a)(e)),e.handleManualControlClick=e.handleManualControlClick.bind(Object(d.a)(e)),e._agents=te,e.agentInstances=[],e._settings=re,e.state={statsToDisplay:{},agentObservation:null,godObservation:null,universalGameNumber:0,currentAgentIndex:0,speed:e._settings.speed,lastStatusRenderTime:0,lastStatusChartRenderTime:0,scoreHistoryChartData:null},e}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentWillMount",value:function(){this._gameRunner=new ae(this.handleGameRendererRender,this.handleGameRunnerStatusChange),this.clearStatsAndNewGame(),this.setupInterval()}},{key:"handleGameRendererRender",value:function(e,t,n){this.setState({agentObservation:e,godObservation:t,universalGameNumber:n})}},{key:"handleGameRunnerStatusChange",value:function(e){var t=(new Date).getTime();if(t>this.state.lastStatusRenderTime+250&&this.setState({statsToDisplay:{"Current Score":e.currentScore.toFixed(3),"Actions per second":e.actionsPerSecond.toLocaleString(),"Last Game Final Score":e.lastGameScore.toFixed(3),"Average Final Score (trailing)":e.averageFinalScore.toFixed(3),"Average Final Score (all time)":(e.scoreSum/e.gameCount||0).toFixed(3),"Game Count":e.gameCount.toLocaleString()},lastStatusRenderTime:t}),t>this.state.lastStatusChartRenderTime+50){if(re.renderingEnabled)return;this.setState({scoreHistoryChartData:e,lastStatusChartRenderTime:t})}}},{key:"setupInterval",value:function(){var e=this;if(clearInterval(this._intervalReference),this._settings.autoPlay){var t=this._settings.ticksPerIntervalWhenNotRendering;this._agents[this.state.currentAgentIndex].ticksPerInterval&&(t=this._agents[this.state.currentAgentIndex].ticksPerInterval),this._settings.renderingEnabled&&(t=1),this._intervalReference=setInterval((function(){for(var n=0;n<t;n++)e._gameRunner.tick()}),this._settings.speed)}}},{key:"clearStatsAndNewGame",value:function(){this._gameRunner.setRenderingEnabled(this._settings.renderingEnabled),this._gameRunner.clearStats(),this.agentInstances[this.state.currentAgentIndex]||(this.agentInstances[this.state.currentAgentIndex]=new this._agents[this.state.currentAgentIndex].class),this._gameRunner.newGame(this.agentInstances[this.state.currentAgentIndex],this._settings.renderingEnabled)}},{key:"setSpeed",value:function(e){this.setState({speed:e});var t=!0;this._settings.autoPlay=!0,"no-render"===e?(t=!1,this._settings.speed=0):"paused"===e?this._settings.autoPlay=!1:this._settings.speed=e,t!==this._settings.renderingEnabled&&(this._settings.renderingEnabled=t,this._gameRunner.setRenderingEnabled(this._settings.renderingEnabled)),this.setupInterval()}},{key:"handleSpeedSelectorChange",value:function(e){this.setSpeed(e.target.value)}},{key:"componentDidUpdate",value:function(e,t){t.currentAgentIndex!==this.state.currentAgentIndex&&(this.clearStatsAndNewGame(),this.setupInterval())}},{key:"handleAgentSelectorChange",value:function(e){this.setState({currentAgentIndex:e.target.value})}},{key:"handleClearBrainClick",value:function(){this._gameRunner.clearCurrentAgentBrain(),this.clearStatsAndNewGame()}},{key:"handleManualControlKeyDown",value:function(e){var t=S.indexOf(e.key);-1!==t&&this._gameRunner.takeAction(t)}},{key:"handleManualControlClick",value:function(){this.setSpeed("paused")}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",{id:"info"},"Agent:",i.a.createElement("select",{onChange:this.handleAgentSelectorChange},this._agents.map((function(e,t){return i.a.createElement("option",{key:t,value:t},e.name)}))),"\xa0",i.a.createElement("button",{onClick:this.handleClearBrainClick},"Clear Brain and Retrain"),i.a.createElement("br",null),"Speed:",i.a.createElement("select",{onChange:this.handleSpeedSelectorChange,value:this.state.speed},i.a.createElement("option",{value:"no-render"},"Ludicrous Speed (no rendering)"),i.a.createElement("option",{value:"0"},"Very Fast"),i.a.createElement("option",{value:"100"},"Fast"),i.a.createElement("option",{value:"250"},"Medium"),i.a.createElement("option",{value:"500"},"Slow"),i.a.createElement("option",{value:"paused"},"Paused")),"\xa0",i.a.createElement("button",{type:"text",onKeyDown:this.handleManualControlKeyDown,onClick:this.handleManualControlClick},"Enable Manual Control (WASD)"),i.a.createElement("pre",{id:"score"}),i.a.createElement(ie,{stats:this.state.statsToDisplay}),i.a.createElement("br",null)),!this._settings.renderingEnabled&&this.state.scoreHistoryChartData&&i.a.createElement("div",{style:{width:"30em"}},i.a.createElement(C,{stats:this.state.scoreHistoryChartData})),this._settings.renderingEnabled&&this.state.agentObservation&&i.a.createElement("div",null,i.a.createElement(_,{agentObservation:this.state.agentObservation,godObservation:this.state.godObservation,gameNumber:this.state.universalGameNumber}),i.a.createElement("div",{id:"agentRendererContainer"}),this._agents[this.state.currentAgentIndex].description&&i.a.createElement("div",null,this._agents[this.state.currentAgentIndex].description)),i.a.createElement("br",null),i.a.createElement(E,{environmentConfig:y}),i.a.createElement("br",null),i.a.createElement(w,{gameRunner:this._gameRunner}))}}]),t}(a.Component);n(38);o.a.render(i.a.createElement(oe,null),document.getElementById("root"))}},[[19,1,2]]]);
//# sourceMappingURL=main.08285ad0.chunk.js.map